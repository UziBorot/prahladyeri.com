<!DOCTYPE html>
<html lang="english">
<head>
        <meta charset="utf-8" />
        <title>How to use Bash+rsync to automate your periodical backups on Linux</title>
        <link rel="stylesheet" href="https://prahladyeri.com/theme/css/main.css" />
        <link href="https://prahladyeri.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri - Freelance Programmer Atom Feed" />
		
	<meta name="twitter:card" content="summary" />
	 <meta name="twitter:site" content="@prahladyeri" />
	 <meta name="twitter:creator" value="@prahladyeri" />
		<meta name="twitter:url" content="blog/2018/03/how-to-use-bashrsync-to-automate-your-periodical-backups-on-linux.html" />
	 	 <meta name="twitter:title" content="How to use Bash+rsync to automate your periodical backups on Linux" />
		<meta name="twitter:description" content="<p><strong>Linux</strong> is all about simplicity. Simple and time-tested tools like <code>iptables</code>, <code>netstat</code> and <code>rsync</code> can be called for help for basic tasks instead of untrusted third-party tools as happens in case of Windows. If you are a desktop user, then taking frequent backups of your data to a pen-drive or â€¦</p>" />		
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://prahladyeri.com/">Prahlad Yeri - Freelance Programmer </a></h1>
                <nav><ul>
				<li><a href="/">Home</a></li> <!--hard coded-->
                    <li><a href="https://prahladyeri.com/about/">About</a></li>
                    <li><a href="https://prahladyeri.com/projects/">Projects</a></li>
                    <li><a href="https://prahladyeri.com/hire-me/">Hire Me</a></li>
				<li><a href="https://github.com/prahladyeri/resume">Resume</a></li> <!--hard coded-->
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://prahladyeri.com/blog/2018/03/how-to-use-bashrsync-to-automate-your-periodical-backups-on-linux.html" rel="bookmark"
           title="Permalink to How to use Bash+rsync to automate your periodical backups on Linux">How to use Bash+rsync to automate your periodical backups on Linux</a></h1>
<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="prahladyeri">Tweet</a><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-03-04T13:05:00+05:30">
                Published: Sun 04 March 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://prahladyeri.com/author/prahlad-yeri.html">Prahlad Yeri</a>
        </address>
<p>In <a href="https://prahladyeri.com/category/linux.html">Linux</a>.</p>
<p>tags: <a href="https://prahladyeri.com/tag/backup.html">Backup</a> <a href="https://prahladyeri.com/tag/linux.html">Linux</a> <a href="https://prahladyeri.com/tag/ubuntu.html">Ubuntu</a> </p>
</footer><!-- /.post-info -->      <p><strong>Linux</strong> is all about simplicity. Simple and time-tested tools like <code>iptables</code>, <code>netstat</code> and <code>rsync</code> can be called for help for basic tasks instead of untrusted third-party tools as happens in case of Windows. If you are a desktop user, then taking frequent backups of your data to a pen-drive or external disk is a typical problem to solve.<!--more--></p>
<p>In this article, I'll show how I solved this problem using a combination of <strong>bash scripting</strong> and <strong>rsync</strong>, the basic tooling available on any linux distro these days, be it Ubuntu, Debian or Fedora.</p>
<p>One of the things you may want to do is determine what folder(s) you want to backup to which device. You may want to copy the source code folder only to your pen drive and your images and documents to only external drive, for instance. Here is where identifying the disk label through bash comes in handy in the backup script:</p>
<div class="highlight"><pre><span></span>if [ -d &quot;/media/prahlad/DATA128&quot; ]; then
    device_name=&quot;DATA128&quot;
    folder_name=&quot;/media/prahlad/DATA128&quot;
elif [ -d &quot;/media/prahlad/extHD&quot; ]; then
    device_name=&quot;extHD&quot;
    folder_name=&quot;/media/prahlad/extHD&quot;
else
    echo &quot;No Drive Found&quot;
    exit
fi
</pre></div>


<p>In the above example, <strong>DATA128</strong> is a pen-drive and <strong>extHD</strong> is an external hard-drive and the above script determines which disk is inserted in the USB drive. You can then use the <strong>\$folder_name</strong> bash variable to dynamically copy to that device instead of hard-coding that path unnecessarily. You can also use <strong>\$device_name</strong> bash variable to include or skip specific folders when running the rsync command:</p>
<div class="highlight"><pre><span></span>rsync -va /home/prahlad/source &quot;$folder_name/source&quot;

if [ &quot;$device_name&quot; = &quot;extHD&quot; ]; then
 rsync -va /home/prahlad/Pictures &quot;$folder_name/home/Pictures&quot;
 rsync -va /home/prahlad/Documents &quot;$folder_name/home/Documents&quot;
fi
</pre></div>


<p>The <strong>rsync</strong> command itself is also versatile enough to do a lot of things which are not possible using a simple copy-paste-replace using a file manager. For instance, the "a" or "--archive" option intelligently archives (copies) files while skipping identical ones based on checksum or modification date automatically. Further, the "--delete" option deletes files which are present on the destination backup device, but not on the source device which is typically the case when you want to backup your data. Run "man rsync" to see the full range of options exposed by this wonderful command.</p>
<p>Finally, another advantage of using a script for backup automation is that you can implement custom actions through the script. For example, compressing the mozilla firefox user folder before taking its backup:</p>
<div class="highlight"><pre><span></span>echo &quot;backing up firefox...&quot;
tar czf ~/firefox-backup.tar.gz ~/.mozilla/firefox/
rsync -va ~/firefox-backup.tar.gz &quot;$folder_name/home/firefox-backup.tar.gz&quot;
</pre></div>


<p>Below is a typical example of how you might implement a script to automate backup of your home folder and set this as a cron job to run say weekly or fortnightly:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="k">if</span> <span class="o">[</span> -d <span class="s2">&quot;/media/prahlad/DATA128&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nv">device_name</span><span class="o">=</span><span class="s2">&quot;DATA128&quot;</span>
 <span class="nv">folder_name</span><span class="o">=</span><span class="s2">&quot;/media/prahlad/DATA128&quot;</span>
<span class="k">elif</span> <span class="o">[</span> -d <span class="s2">&quot;/media/prahlad/extHD&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nv">device_name</span><span class="o">=</span><span class="s2">&quot;extHD&quot;</span>
 <span class="nv">folder_name</span><span class="o">=</span><span class="s2">&quot;/media/prahlad/extHD&quot;</span>
<span class="k">else</span>
 <span class="nb">echo</span> <span class="s2">&quot;No Drive Found&quot;</span>
 <span class="nb">exit</span>
<span class="k">fi</span>

<span class="nb">echo</span> <span class="s2">&quot;Device: </span><span class="nv">$device_name</span><span class="s2">&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Folder: </span><span class="nv">$folder_name</span><span class="s2">&quot;</span>

<span class="c1">#start copying</span>

<span class="c1">#home</span>
rsync -va ~/.bashrc <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/&quot;</span> --delete
rsync -va ~/.profile <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/&quot;</span> --delete
rsync -va ~/Downloads/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/Downloads/&quot;</span> --delete
rsync -va ~/Documents/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/Documents/&quot;</span> --delete
rsync -va ~/Pictures/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/Pictures/&quot;</span> --delete
rsync -va ~/.ssh/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/.ssh/&quot;</span> --delete
rsync -va ~/.gnupg/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/.gnupg/&quot;</span> --delete
rsync -va ~/.thunderbird/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/.thunderbird/&quot;</span> --delete
rsync -va ~/.mozilla/ <span class="s2">&quot;</span><span class="nv">$folder_name</span><span class="s2">/home/.mozilla/&quot;</span> --delete

<span class="nb">echo</span> <span class="s2">&quot;Done&quot;</span>
</pre></div>
</td></tr></table>

<p>You can customize the above script by adding custom actions or if conditions to skip or include specific folders based on the device label. If you know of any other techniques for backup automation on linux, then please let us know through comments.</p>
    </div><!-- /.entry-content -->
	
	<!-- Start: Prahlad -->
	<!--start: adsense-->
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- mainsite_responsive -->
	<ins class="adsbygoogle"
		 style="display:block"
		 data-ad-client="ca-pub-0428291735937735"
		 data-ad-slot="6897031752"
		 data-ad-format="auto"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
	<!--end: adsense-->
	<!-- End: Prahlad -->

    <div class="comments">
      <h2>Comments !</h2>
      <div id="disqus_thread"></div>
		<script>
		/**
		*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
		*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
		
		/*var disqus_config = function () {
			this.page.url = 'https://prahladyeri.com/blog/2018/03/how-to-use-bashrsync-to-automate-your-periodical-backups-on-linux.html';  // Replace PAGE_URL with your page's canonical URL variable
			this.page.identifier = 'blog/2018/03/how-to-use-bashrsync-to-automate-your-periodical-backups-on-linux.html'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
		};
		(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		s.src = 'https://prahladyeri-blog.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
		})();*/
		</script>	  
	  
      <script type="text/javascript">
        var disqus_shortname = 'prahladyeri-blog';
        var disqus_identifier = 'blog/2018/03/how-to-use-bashrsync-to-automate-your-periodical-backups-on-linux.html';
        var disqus_url = 'https://prahladyeri.com/blog/2018/03/how-to-use-bashrsync-to-automate-your-periodical-backups-on-linux.html';
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//prahladyeri-blog.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="mailto:prahladyeri@yahoo.com">Email</a></li>
                            <li><a href="https://github.com/prahladyeri/">Github</a></li>
                            <li><a href="https://stackoverflow.com/users/849365/prahlad-yeri/">StackOverflow</a></li>
                            <li><a href="https://www.quora.com/profile/Prahlad-Yeri">Quora</a></li>
                            <li><a href="https://mastodon.social/@prahladyeri">Mastodon.Social</a></li>
                            <li><a href="https://www.blogger.com/profile/12769325975373447545">Blogger</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://prahladyeri.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://www.linkedin.com/in/prahlad-yeri-243a5316">Linkedin</a></li>
                            <li><a href="https://www.facebook.com/prahladyeri14">Facebook</a></li>
                            <li><a href="https://twitter.com/prahladyeri">Twitter</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Copyright (c) 2013-2019 <a href="/">Prahlad Yeri</a>.
				<br>
				This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-6808883-5', 'auto');
    ga('send', 'pageview');
    </script>
<script type="text/javascript">
    var disqus_shortname = 'prahladyeri-blog';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>