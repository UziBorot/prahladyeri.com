<!DOCTYPE html>
<html lang="english">
<head>
        <meta charset="utf-8" />
        <title>Flask Recipe - RESTful CRUD using sqlalchemy</title>
        <link rel="stylesheet" href="https://prahladyeri.com/theme/css/main.css" />
        <link href="https://prahladyeri.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri - Freelance Programmer Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://prahladyeri.com/">Prahlad Yeri - Freelance Programmer </a></h1>
                <nav><ul>
				<li><a href="/">Home</a></li> <!--hard coded-->
                    <li><a href="https://prahladyeri.com/about/">About</a></li>
                    <li><a href="https://prahladyeri.com/projects/">Projects</a></li>
                    <li><a href="https://prahladyeri.com/hire-me/">Hire Me</a></li>
				<li><a href="https://github.com/prahladyeri/resmue">Resume</a></li> <!--hard coded-->
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://prahladyeri.com/blog/2017/06/flask-recipe-restful-crud-using-sqlalchemy.html" rel="bookmark"
           title="Permalink to Flask Recipe - RESTful CRUD using sqlalchemy">Flask Recipe - RESTful CRUD using sqlalchemy</a></h1>
<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="prahladyeri">Tweet</a><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-06-25T04:21:00+05:30">
                Published: Sun 25 June 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://prahladyeri.com/author/prahlad-yeri.html">Prahlad Yeri</a>
        </address>
<p>In <a href="https://prahladyeri.com/category/python.html">Python</a>.</p>
<p>tags: <a href="https://prahladyeri.com/tag/flask.html">Flask</a> <a href="https://prahladyeri.com/tag/python.html">Python</a> <a href="https://prahladyeri.com/tag/sqlalchemy.html">SQLAlchemy</a> </p>
</footer><!-- /.post-info -->      <p>RESTful apps are a thing these days. When your application’s userbase gets quite large and the client could vary from a laptop to an android device to an iOS device, it pays to keep the backend code separate and use the server only for making RESTful calls using HTTP methods that pertain to basic OLTP transactions: SELECT, INSERT, UPDATE and DELETE.<!--more--></p>
<p>Popular third-party apps like <a href="https://en.wikipedia.org/wiki/Firebase#Realtime_Database">Firebase</a> essentially provide you this same thing - A REST based front to a database that could be accessed online using simple HTTP methods. But in this tutorial, we will learn how to create such a backend ourselves using Python’s <code class="highlighter-rouge">flask</code> framework and <code class="highlighter-rouge">sqlalchemy</code>, a light-weight but powerful ORM library that can access ANY database using its flexible <em>sql expression language</em>.</p>
<p><img alt="RESTful CRUD App" src="/uploads/old/restful-crud.png"></p>
<p>Rather than using firebase, if you develop your own implementation of your back-end, not only will it help you learn and become a better programmer, but also give you a flexible solution that you can scale and change as per your needs. Its also much cheaper to host your own solution on Amazon EC2 (or Lambda) compared to other costlier alternatives.</p>
<p>Contrary to popular thinking, its not very difficult to create a database agnostic backend such as the one represented in the above diagram. With a minimal and powerful web framework such as <code class="highlighter-rouge">flask</code>, combined with the power of <code class="highlighter-rouge">sqlalchemy</code>, you can get up and running within minutes. In fact, I’ve developed a prototype version called <a href="https://github.com/prahladyeri/tiddly">Tiddly</a> that essentially does the same thing as above using just 172 lines of Python code. You can refer to that github repository for reference as we proceed through this tutorial, or directly start using it. But make sure you install the following dependencies before running it:</p>
<div class="highlight"><pre><span></span>pip install flask
pip install sqlalchemy
</pre></div>


<p>The first step towards creating the app is creating your database models. Once you’ve done the brainstorming and decided what tables and fields you are going to need, you can create a <code class="highlighter-rouge">models.py</code> source file with something like this:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="c1">#TODO: Change as needed:</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///tiddly.db&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">dbsession</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;User(name=</span><span class="si">%s</span><span class="s2">, email=</span><span class="si">%s</span><span class="s2">, )&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Dual</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;dual&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Dual(id=</span><span class="si">%s</span><span class="s2">, text=</span><span class="si">%s</span><span class="s2">, )&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</pre></div>


<p>I’m using sqlite database for example here, but you can use any one of your choice. A <code class="highlighter-rouge">user</code> table is a pretty basic one in almost every app as it is used for authentication. Apart from that, I’ve also created a <code class="highlighter-rouge">dual</code> table just to play around with.</p>
<p>After that, create the second file <code class="highlighter-rouge">app.py</code> that contains our application code. Define the following import statements along with your models as they will come very handy:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flask</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">import</span> <span class="nn">sqlalchemy</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">inspect</span><span class="p">,</span> <span class="n">desc</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">models</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">engine</span><span class="p">,</span> <span class="n">dbsession</span>
</pre></div>


<p>Now, the only thing that remains to be done is the plumbing the <code class="highlighter-rouge">HTTP</code> methods to their respective database operations. You can either create a separate view function for each one or use a single one for all of them. In this example, I’m using a single function for simplicity.</p>
<div class="highlight"><pre><span></span><span class="s s-Atom">@app</span><span class="p">.</span><span class="nf">route</span><span class="p">(</span><span class="s2">&quot;/&lt;table_name&gt;&quot;</span><span class="p">,</span> <span class="s s-Atom">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="s2">&quot;FETCH&quot;</span><span class="p">])</span>
<span class="s s-Atom">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="s s-Atom">table_name</span><span class="p">)</span><span class="s s-Atom">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;verb: %s, tablename: %s&quot;</span> <span class="c1">% (request.method, table_name))</span>
    <span class="s s-Atom">if</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="s s-Atom">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="s s-Atom">or</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="s s-Atom">method</span> <span class="o">==</span> <span class="s2">&quot;PUT&quot;</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">data</span> <span class="o">=</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="nf">get_json</span><span class="p">(</span><span class="s s-Atom">force</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;data:&quot;</span><span class="p">,</span> <span class="s s-Atom">data</span><span class="p">)</span>
        <span class="nn">try</span><span class="p">:</span>
            <span class="nv">TableClass</span> <span class="o">=</span> <span class="s s-Atom">models</span><span class="p">.</span><span class="nf">get_class_by_tablename</span><span class="p">(</span><span class="s s-Atom">table_name</span><span class="p">)</span>
            <span class="s s-Atom">if</span> <span class="nv">TableClass</span> <span class="o">==</span> <span class="nv">None</span><span class="s s-Atom">:</span> <span class="s s-Atom">raise</span> <span class="nv">Exception</span><span class="p">(</span><span class="s2">&quot;Table not found: %s&quot;</span> <span class="c1">% table_name)</span>
            <span class="s s-Atom">if</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="s s-Atom">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="s s-Atom">:</span> <span class="s s-Atom">#insert</span> <span class="s s-Atom">data</span>
                <span class="s s-Atom">object</span> <span class="o">=</span> <span class="nv">TableClass</span><span class="p">(</span><span class="s s-Atom">**data</span><span class="p">)</span>
                <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s s-Atom">object</span><span class="p">)</span>
                <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
            <span class="nn">else</span><span class="p">:</span> <span class="s s-Atom">#update</span> <span class="s s-Atom">data</span>
                <span class="s s-Atom">object</span> <span class="o">=</span> <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">TableClass</span><span class="p">).</span><span class="nf">filter_by</span><span class="p">(</span><span class="s s-Atom">**</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="s s-Atom">:id</span><span class="p">}).</span><span class="nf">first</span><span class="p">()</span>
                <span class="s s-Atom">if</span> <span class="s s-Atom">object</span> <span class="o">==</span> <span class="nv">None</span><span class="s s-Atom">:</span> <span class="s s-Atom">raise</span> <span class="nv">Exception</span><span class="p">(</span><span class="s2">&quot;No data found.&quot;</span><span class="p">)</span>
                <span class="s s-Atom">#object</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="s s-Atom">**data</span><span class="p">)</span>
                <span class="s s-Atom">for</span> <span class="s s-Atom">key</span> <span class="s s-Atom">in</span> <span class="s s-Atom">data</span><span class="p">.</span><span class="nf">keys</span><span class="p">()</span><span class="s s-Atom">:</span>
                    <span class="nf">setattr</span><span class="p">(</span><span class="s s-Atom">object</span><span class="p">,</span> <span class="s s-Atom">key</span><span class="p">,</span> <span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">key</span><span class="p">])</span>
                <span class="s s-Atom">#dbsession</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s s-Atom">object</span><span class="p">)</span>
                <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="s s-Atom">:</span> <span class="s s-Atom">object</span><span class="p">.</span><span class="s s-Atom">id</span><span class="p">,</span>
                <span class="p">})</span>
        <span class="s s-Atom">except</span> <span class="nv">Exception</span> <span class="s s-Atom">as</span> <span class="nn">e</span><span class="p">:</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="s s-Atom">:</span> <span class="nf">str</span><span class="p">(</span><span class="s s-Atom">e</span><span class="p">),</span>
                <span class="p">})</span>
    <span class="s s-Atom">elif</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="s s-Atom">method</span> <span class="o">==</span> <span class="s2">&quot;DELETE&quot;</span><span class="s s-Atom">:</span>
        <span class="nn">try</span><span class="p">:</span>
            <span class="nv">TableClass</span> <span class="o">=</span> <span class="s s-Atom">models</span><span class="p">.</span><span class="nf">get_class_by_tablename</span><span class="p">(</span><span class="s s-Atom">table_name</span><span class="p">)</span>
            <span class="s s-Atom">if</span> <span class="nv">TableClass</span> <span class="o">==</span> <span class="nv">None</span><span class="s s-Atom">:</span> <span class="s s-Atom">raise</span> <span class="nv">Exception</span><span class="p">(</span><span class="s2">&quot;Table not found: %s&quot;</span> <span class="c1">% table_name)</span>
            <span class="s s-Atom">object</span> <span class="o">=</span> <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">TableClass</span><span class="p">).</span><span class="nf">filter_by</span><span class="p">(</span><span class="s s-Atom">**</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="s s-Atom">:id</span><span class="p">}).</span><span class="nf">first</span><span class="p">()</span>
            <span class="s s-Atom">if</span> <span class="s s-Atom">object</span> <span class="o">==</span> <span class="nv">None</span><span class="s s-Atom">:</span> <span class="s s-Atom">raise</span> <span class="nv">Exception</span><span class="p">(</span><span class="s2">&quot;No data found.&quot;</span><span class="p">)</span>
            <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="s s-Atom">object</span><span class="p">)</span>
            <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="s s-Atom">:</span> <span class="s s-Atom">object</span><span class="p">.</span><span class="s s-Atom">id</span><span class="p">,</span>
                <span class="p">})</span>
        <span class="s s-Atom">except</span> <span class="nv">Exception</span> <span class="s s-Atom">as</span> <span class="nn">e</span><span class="p">:</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="s s-Atom">:</span> <span class="nf">str</span><span class="p">(</span><span class="s s-Atom">e</span><span class="p">),</span>
                <span class="p">})</span>
    <span class="s s-Atom">elif</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="s s-Atom">method</span> <span class="o">==</span> <span class="s2">&quot;FETCH&quot;</span><span class="s s-Atom">:</span>
        <span class="nn">try</span><span class="p">:</span>
            <span class="s s-Atom">data</span> <span class="o">=</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="nf">get_json</span><span class="p">(</span><span class="s s-Atom">force</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>
            <span class="s s-Atom">data</span> <span class="o">=</span> <span class="s s-Atom">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;data: &quot;</span><span class="p">,</span> <span class="s s-Atom">data</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;data-type: &quot;</span><span class="p">,</span> <span class="nf">type</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">))</span>
            <span class="nv">TableClass</span> <span class="o">=</span> <span class="s s-Atom">models</span><span class="p">.</span><span class="nf">get_class_by_tablename</span><span class="p">(</span><span class="s s-Atom">table_name</span><span class="p">)</span>
            <span class="s s-Atom">if</span> <span class="nv">TableClass</span> <span class="o">==</span> <span class="nv">None</span><span class="s s-Atom">:</span> <span class="s s-Atom">raise</span> <span class="nv">Exception</span><span class="p">(</span><span class="s2">&quot;Table not found: %s&quot;</span> <span class="c1">% table_name)</span>

            <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">TableClass</span><span class="p">).</span><span class="nf">filter_by</span><span class="p">(</span><span class="s s-Atom">**data</span><span class="p">[</span><span class="s s-Atom">&#39;where&#39;</span><span class="p">])</span>
            <span class="s s-Atom">if</span> <span class="s s-Atom">&#39;orderby&#39;</span> <span class="s s-Atom">in</span> <span class="nn">data</span><span class="p">:</span>
                <span class="s s-Atom">for</span> <span class="s s-Atom">cname</span> <span class="s s-Atom">in</span> <span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;orderby&#39;</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s s-Atom">&#39;,&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
                    <span class="s s-Atom">reverse</span> <span class="o">=</span> <span class="nv">False</span>
                    <span class="s s-Atom">if</span> <span class="s s-Atom">cname</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="s s-Atom">&#39; desc&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
                        <span class="s s-Atom">reverse</span> <span class="o">=</span> <span class="nv">True</span>
                        <span class="s s-Atom">cname</span> <span class="o">=</span> <span class="s s-Atom">cname</span><span class="p">[:-</span><span class="mi">5</span><span class="p">]</span>
                    <span class="s s-Atom">elif</span> <span class="s s-Atom">cname</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="s s-Atom">&#39; asc&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
                        <span class="s s-Atom">cname</span> <span class="o">=</span> <span class="s s-Atom">cname</span><span class="p">[:-</span><span class="mi">4</span><span class="p">]</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;cname: &quot;</span><span class="p">,</span> <span class="s s-Atom">cname</span><span class="p">)</span>
                    <span class="s s-Atom">column</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="nv">TableClass</span><span class="p">,</span> <span class="s s-Atom">cname</span><span class="p">)</span>
                    <span class="s s-Atom">if</span> <span class="nn">reverse</span><span class="p">:</span> <span class="s s-Atom">column</span> <span class="o">=</span> <span class="nf">desc</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">)</span>
                    <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">order_by</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">)</span>
            <span class="s s-Atom">if</span> <span class="s s-Atom">&#39;limit&#39;</span> <span class="s s-Atom">in</span> <span class="nn">data</span><span class="p">:</span>
                <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;limit&#39;</span><span class="p">])</span>
                <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">offset</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;offset&#39;</span><span class="p">])</span>
            <span class="s s-Atom">object</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">all</span><span class="p">()</span>
            <span class="s s-Atom">data</span> <span class="o">=</span> <span class="p">[</span><span class="nf">object_as_dict</span><span class="p">(</span><span class="s s-Atom">t</span><span class="p">)</span> <span class="s s-Atom">for</span> <span class="s s-Atom">t</span> <span class="s s-Atom">in</span> <span class="s s-Atom">object</span><span class="p">]</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span> 
                <span class="s2">&quot;data&quot;</span><span class="s s-Atom">:</span> <span class="s s-Atom">data</span>
                <span class="p">})</span>
        <span class="s s-Atom">except</span> <span class="nv">Exception</span> <span class="s s-Atom">as</span> <span class="nn">e</span><span class="p">:</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="s s-Atom">:</span> <span class="nf">str</span><span class="p">(</span><span class="s s-Atom">e</span><span class="p">),</span>
                <span class="p">})</span>
    <span class="nn">else</span><span class="p">:</span>
        <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;Unrecognized verb.&quot;</span><span class="p">,</span>
            <span class="p">})</span>
</pre></div>


<p>I’ve used a non-standard HTTP method, <code class="highlighter-rouge">FETCH</code> for the <code class="highlighter-rouge">SELECT</code> action. That’s because if you use the <code class="highlighter-rouge">GET</code> method, you aren’t allowed to actually post data (as in actual posting, don’t confuse with <code class="highlighter-rouge">POST</code> method) as per the HTTP specification. The other methods, viz <code class="highlighter-rouge">POST</code>, <code class="highlighter-rouge">PUT</code> and <code class="highlighter-rouge">DELETE</code> are self-apparent and they stand for <code class="highlighter-rouge">INSERT</code>, <code class="highlighter-rouge">UPDATE</code> and <code class="highlighter-rouge">DELETE</code> actions respectively.</p>
<p>As you can see, the app makes good use of the sql expression language of sqlalchemy to dynamically query any kind of data, not only using the usual <code class="highlighter-rouge">where</code> clause, but also using ordering and pagination (limit/offset) parameters:</p>
<div class="highlight"><pre><span></span><span class="s s-Atom">if</span> <span class="s s-Atom">&#39;orderby&#39;</span> <span class="s s-Atom">in</span> <span class="nn">data</span><span class="p">:</span>
    <span class="s s-Atom">for</span> <span class="s s-Atom">cname</span> <span class="s s-Atom">in</span> <span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;orderby&#39;</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s s-Atom">&#39;,&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">reverse</span> <span class="o">=</span> <span class="nv">False</span>
        <span class="s s-Atom">if</span> <span class="s s-Atom">cname</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="s s-Atom">&#39; desc&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
            <span class="s s-Atom">reverse</span> <span class="o">=</span> <span class="nv">True</span>
            <span class="s s-Atom">cname</span> <span class="o">=</span> <span class="s s-Atom">cname</span><span class="p">[:-</span><span class="mi">5</span><span class="p">]</span>
        <span class="s s-Atom">elif</span> <span class="s s-Atom">cname</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="s s-Atom">&#39; asc&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
            <span class="s s-Atom">cname</span> <span class="o">=</span> <span class="s s-Atom">cname</span><span class="p">[:-</span><span class="mi">4</span><span class="p">]</span>
        <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;cname: &quot;</span><span class="p">,</span> <span class="s s-Atom">cname</span><span class="p">)</span>
        <span class="s s-Atom">column</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="nv">TableClass</span><span class="p">,</span> <span class="s s-Atom">cname</span><span class="p">)</span>
        <span class="s s-Atom">if</span> <span class="nn">reverse</span><span class="p">:</span> <span class="s s-Atom">column</span> <span class="o">=</span> <span class="nf">desc</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">)</span>
        <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">order_by</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">)</span>
<span class="s s-Atom">if</span> <span class="s s-Atom">&#39;limit&#39;</span> <span class="s s-Atom">in</span> <span class="nn">data</span><span class="p">:</span>
    <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;limit&#39;</span><span class="p">])</span>
    <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">offset</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;offset&#39;</span><span class="p">])</span>
</pre></div>


<p>The front-end sends whatever it needs to the back-end using JSON format and the result is also in JSON. For example, the following JSON when posted to <code class="highlighter-rouge">/user</code> endpoint using <code class="highlighter-rouge">FETCH</code> method, returns the record from user table where <code class="highlighter-rouge">name</code> field matches <code class="highlighter-rouge">admin</code> and orders the results by email in descending order.</p>
<div class="highlight"><pre><span></span>{&quot;where&quot;: {&quot;name&quot;:&quot;admin&quot;}, &quot;orderby&quot;: &quot;email desc&quot;}
</pre></div>


<p>Adding the <code class="highlighter-rouge">limit</code> and <code class="highlighter-rouge">offset</code> clauses to the same can help the front-end with pagination.</p>
<div class="highlight"><pre><span></span>{&quot;where&quot;: {&quot;name&quot;:&quot;admin&quot;}, &quot;orderby&quot;: &quot;email desc&quot;, &quot;limit&quot;:2, &quot;offset&quot;: 2}
</pre></div>


<p>Its also pretty trivial to implement user authentication with this design. I haven’t done it in this example for simplicity, but you can find it in the <a href="https://github.com/prahladyeri/tiddly">github code</a>.</p>
<p>All code in this tutorial and on github is <code class="highlighter-rouge">MIT</code> licensed and free to use. So, enjoy coding, build your own RESTful CRUD app, and let me know how it goes via comments below!</p>
    </div><!-- /.entry-content -->
	
	<!-- Start: Prahlad -->
	<!--start: adsense-->
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- mainsite_responsive -->
	<ins class="adsbygoogle"
		 style="display:block"
		 data-ad-client="ca-pub-0428291735937735"
		 data-ad-slot="6897031752"
		 data-ad-format="auto"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
	<!--end: adsense-->
	<!-- End: Prahlad -->

    <div class="comments">
      <h2>Comments !</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'https://prahladyeri-blog.disqus.com';
        var disqus_identifier = 'blog/2017/06/flask-recipe-restful-crud-using-sqlalchemy.html';
        var disqus_url = 'https://prahladyeri.com/blog/2017/06/flask-recipe-restful-crud-using-sqlalchemy.html';
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//https://prahladyeri-blog.disqus.com.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="mailto:prahladyeri@yahoo.com">Email</a></li>
                            <li><a href="https://github.com/prahladyeri/">Github</a></li>
                            <li><a href="https://stackoverflow.com/users/849365/prahlad-yeri/">StackOverflow</a></li>
                            <li><a href="https://www.quora.com/profile/Prahlad-Yeri">Quora</a></li>
                            <li><a href="https://mastodon.social/@prahladyeri">Mastodon.Social</a></li>
                            <li><a href="https://www.blogger.com/profile/12769325975373447545">Blogger</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://prahladyeri.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://www.linkedin.com/in/prahlad-yeri-243a5316">Linkedin</a></li>
                            <li><a href="https://www.facebook.com/prahladyeri14">Facebook</a></li>
                            <li><a href="https://twitter.com/prahladyeri">Twitter</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Copyright (c) 2013-2019 <a href="/">Prahlad Yeri</a>.
				<br>
				This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-6808883-5', 'auto');
    ga('send', 'pageview');
    </script>
<script type="text/javascript">
    var disqus_shortname = 'https://prahladyeri-blog.disqus.com';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>