<!DOCTYPE html>
<html lang="english">
<head>
        <meta charset="utf-8" />
        <title>Prahlad Yeri - Freelance Programmer - Python</title>
        <link rel="stylesheet" href="https://prahladyeri.com/theme/css/main.css" />
        <link href="https://prahladyeri.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri - Freelance Programmer Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://prahladyeri.com/">Prahlad Yeri - Freelance Programmer </a></h1>
                <nav><ul>
				<li><a href="/">Home</a></li> <!--hard coded-->
                    <li><a href="https://prahladyeri.com/about/">About</a></li>
                    <li><a href="https://prahladyeri.com/projects/">Projects</a></li>
                    <li><a href="https://prahladyeri.com/hire-me/">Hire Me</a></li>
				<li><a href="https://github.com/prahladyeri/resume">Resume</a></li> <!--hard coded-->
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://prahladyeri.com/blog/2017/06/flask-recipe-restful-crud-using-sqlalchemy.html">Flask Recipe - RESTful CRUD using sqlalchemy</a></h1>
<footer class="post-info">
        <abbr class="published" title="2017-06-25T04:21:00+05:30">
                Published: Sun 25 June 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://prahladyeri.com/author/prahlad-yeri.html">Prahlad Yeri</a>
        </address>
<p>In <a href="https://prahladyeri.com/category/python.html">Python</a>.</p>
<p>tags: <a href="https://prahladyeri.com/tag/flask.html">Flask</a> <a href="https://prahladyeri.com/tag/python.html">Python</a> <a href="https://prahladyeri.com/tag/sqlalchemy.html">SQLAlchemy</a> </p>
</footer><!-- /.post-info --><p>RESTful apps are a thing these days. When your application’s userbase gets quite large and the client could vary from a laptop to an android device to an iOS device, it pays to keep the backend code separate and use the server only for making RESTful calls using HTTP methods that pertain to basic OLTP transactions: SELECT, INSERT, UPDATE and DELETE.<!--more--></p>
<p>Popular third-party apps like <a href="https://en.wikipedia.org/wiki/Firebase#Realtime_Database">Firebase</a> essentially provide you this same thing - A REST based front to a database that could be accessed online using simple HTTP methods. But in this tutorial, we will learn how to create such a backend ourselves using Python’s <code class="highlighter-rouge">flask</code> framework and <code class="highlighter-rouge">sqlalchemy</code>, a light-weight but powerful ORM library that can access ANY database using its flexible <em>sql expression language</em>.</p>
<p><img alt="RESTful CRUD App" src="/uploads/old/restful-crud.png"></p>
<p>Rather than using firebase, if you develop your own implementation of your back-end, not only will it help you learn and become a better programmer, but also give you a flexible solution that you can scale and change as per your needs. Its also much cheaper to host your own solution on Amazon EC2 (or Lambda) compared to other costlier alternatives.</p>
<p>Contrary to popular thinking, its not very difficult to create a database agnostic backend such as the one represented in the above diagram. With a minimal and powerful web framework such as <code class="highlighter-rouge">flask</code>, combined with the power of <code class="highlighter-rouge">sqlalchemy</code>, you can get up and running within minutes. In fact, I’ve developed a prototype version called <a href="https://github.com/prahladyeri/tiddly">Tiddly</a> that essentially does the same thing as above using just 172 lines of Python code. You can refer to that github repository for reference as we proceed through this tutorial, or directly start using it. But make sure you install the following dependencies before running it:</p>
<div class="highlight"><pre><span></span>pip install flask
pip install sqlalchemy
</pre></div>


<p>The first step towards creating the app is creating your database models. Once you’ve done the brainstorming and decided what tables and fields you are going to need, you can create a <code class="highlighter-rouge">models.py</code> source file with something like this:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlalchemy</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>

<span class="c1">#TODO: Change as needed:</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///tiddly.db&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">dbsession</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;User(name=</span><span class="si">%s</span><span class="s2">, email=</span><span class="si">%s</span><span class="s2">, )&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Dual</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;dual&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Dual(id=</span><span class="si">%s</span><span class="s2">, text=</span><span class="si">%s</span><span class="s2">, )&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</pre></div>


<p>I’m using sqlite database for example here, but you can use any one of your choice. A <code class="highlighter-rouge">user</code> table is a pretty basic one in almost every app as it is used for authentication. Apart from that, I’ve also created a <code class="highlighter-rouge">dual</code> table just to play around with.</p>
<p>After that, create the second file <code class="highlighter-rouge">app.py</code> that contains our application code. Define the following import statements along with your models as they will come very handy:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flask</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">import</span> <span class="nn">sqlalchemy</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">inspect</span><span class="p">,</span> <span class="n">desc</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">models</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">engine</span><span class="p">,</span> <span class="n">dbsession</span>
</pre></div>


<p>Now, the only thing that remains to be done is the plumbing the <code class="highlighter-rouge">HTTP</code> methods to their respective database operations. You can either create a separate view function for each one or use a single one for all of them. In this example, I’m using a single function for simplicity.</p>
<div class="highlight"><pre><span></span><span class="s s-Atom">@app</span><span class="p">.</span><span class="nf">route</span><span class="p">(</span><span class="s2">&quot;/&lt;table_name&gt;&quot;</span><span class="p">,</span> <span class="s s-Atom">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span> <span class="s2">&quot;FETCH&quot;</span><span class="p">])</span>
<span class="s s-Atom">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="s s-Atom">table_name</span><span class="p">)</span><span class="s s-Atom">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;verb: %s, tablename: %s&quot;</span> <span class="c1">% (request.method, table_name))</span>
    <span class="s s-Atom">if</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="s s-Atom">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="s s-Atom">or</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="s s-Atom">method</span> <span class="o">==</span> <span class="s2">&quot;PUT&quot;</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">data</span> <span class="o">=</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="nf">get_json</span><span class="p">(</span><span class="s s-Atom">force</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;data:&quot;</span><span class="p">,</span> <span class="s s-Atom">data</span><span class="p">)</span>
        <span class="nn">try</span><span class="p">:</span>
            <span class="nv">TableClass</span> <span class="o">=</span> <span class="s s-Atom">models</span><span class="p">.</span><span class="nf">get_class_by_tablename</span><span class="p">(</span><span class="s s-Atom">table_name</span><span class="p">)</span>
            <span class="s s-Atom">if</span> <span class="nv">TableClass</span> <span class="o">==</span> <span class="nv">None</span><span class="s s-Atom">:</span> <span class="s s-Atom">raise</span> <span class="nv">Exception</span><span class="p">(</span><span class="s2">&quot;Table not found: %s&quot;</span> <span class="c1">% table_name)</span>
            <span class="s s-Atom">if</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="s s-Atom">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="s s-Atom">:</span> <span class="s s-Atom">#insert</span> <span class="s s-Atom">data</span>
                <span class="s s-Atom">object</span> <span class="o">=</span> <span class="nv">TableClass</span><span class="p">(</span><span class="s s-Atom">**data</span><span class="p">)</span>
                <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s s-Atom">object</span><span class="p">)</span>
                <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
            <span class="nn">else</span><span class="p">:</span> <span class="s s-Atom">#update</span> <span class="s s-Atom">data</span>
                <span class="s s-Atom">object</span> <span class="o">=</span> <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">TableClass</span><span class="p">).</span><span class="nf">filter_by</span><span class="p">(</span><span class="s s-Atom">**</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="s s-Atom">:id</span><span class="p">}).</span><span class="nf">first</span><span class="p">()</span>
                <span class="s s-Atom">if</span> <span class="s s-Atom">object</span> <span class="o">==</span> <span class="nv">None</span><span class="s s-Atom">:</span> <span class="s s-Atom">raise</span> <span class="nv">Exception</span><span class="p">(</span><span class="s2">&quot;No data found.&quot;</span><span class="p">)</span>
                <span class="s s-Atom">#object</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="s s-Atom">**data</span><span class="p">)</span>
                <span class="s s-Atom">for</span> <span class="s s-Atom">key</span> <span class="s s-Atom">in</span> <span class="s s-Atom">data</span><span class="p">.</span><span class="nf">keys</span><span class="p">()</span><span class="s s-Atom">:</span>
                    <span class="nf">setattr</span><span class="p">(</span><span class="s s-Atom">object</span><span class="p">,</span> <span class="s s-Atom">key</span><span class="p">,</span> <span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">key</span><span class="p">])</span>
                <span class="s s-Atom">#dbsession</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s s-Atom">object</span><span class="p">)</span>
                <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="s s-Atom">:</span> <span class="s s-Atom">object</span><span class="p">.</span><span class="s s-Atom">id</span><span class="p">,</span>
                <span class="p">})</span>
        <span class="s s-Atom">except</span> <span class="nv">Exception</span> <span class="s s-Atom">as</span> <span class="nn">e</span><span class="p">:</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="s s-Atom">:</span> <span class="nf">str</span><span class="p">(</span><span class="s s-Atom">e</span><span class="p">),</span>
                <span class="p">})</span>
    <span class="s s-Atom">elif</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="s s-Atom">method</span> <span class="o">==</span> <span class="s2">&quot;DELETE&quot;</span><span class="s s-Atom">:</span>
        <span class="nn">try</span><span class="p">:</span>
            <span class="nv">TableClass</span> <span class="o">=</span> <span class="s s-Atom">models</span><span class="p">.</span><span class="nf">get_class_by_tablename</span><span class="p">(</span><span class="s s-Atom">table_name</span><span class="p">)</span>
            <span class="s s-Atom">if</span> <span class="nv">TableClass</span> <span class="o">==</span> <span class="nv">None</span><span class="s s-Atom">:</span> <span class="s s-Atom">raise</span> <span class="nv">Exception</span><span class="p">(</span><span class="s2">&quot;Table not found: %s&quot;</span> <span class="c1">% table_name)</span>
            <span class="s s-Atom">object</span> <span class="o">=</span> <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">TableClass</span><span class="p">).</span><span class="nf">filter_by</span><span class="p">(</span><span class="s s-Atom">**</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="s s-Atom">:id</span><span class="p">}).</span><span class="nf">first</span><span class="p">()</span>
            <span class="s s-Atom">if</span> <span class="s s-Atom">object</span> <span class="o">==</span> <span class="nv">None</span><span class="s s-Atom">:</span> <span class="s s-Atom">raise</span> <span class="nv">Exception</span><span class="p">(</span><span class="s2">&quot;No data found.&quot;</span><span class="p">)</span>
            <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="s s-Atom">object</span><span class="p">)</span>
            <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="s s-Atom">:</span> <span class="s s-Atom">object</span><span class="p">.</span><span class="s s-Atom">id</span><span class="p">,</span>
                <span class="p">})</span>
        <span class="s s-Atom">except</span> <span class="nv">Exception</span> <span class="s s-Atom">as</span> <span class="nn">e</span><span class="p">:</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="s s-Atom">:</span> <span class="nf">str</span><span class="p">(</span><span class="s s-Atom">e</span><span class="p">),</span>
                <span class="p">})</span>
    <span class="s s-Atom">elif</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="s s-Atom">method</span> <span class="o">==</span> <span class="s2">&quot;FETCH&quot;</span><span class="s s-Atom">:</span>
        <span class="nn">try</span><span class="p">:</span>
            <span class="s s-Atom">data</span> <span class="o">=</span> <span class="s s-Atom">request</span><span class="p">.</span><span class="nf">get_json</span><span class="p">(</span><span class="s s-Atom">force</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>
            <span class="s s-Atom">data</span> <span class="o">=</span> <span class="s s-Atom">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;data: &quot;</span><span class="p">,</span> <span class="s s-Atom">data</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;data-type: &quot;</span><span class="p">,</span> <span class="nf">type</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">))</span>
            <span class="nv">TableClass</span> <span class="o">=</span> <span class="s s-Atom">models</span><span class="p">.</span><span class="nf">get_class_by_tablename</span><span class="p">(</span><span class="s s-Atom">table_name</span><span class="p">)</span>
            <span class="s s-Atom">if</span> <span class="nv">TableClass</span> <span class="o">==</span> <span class="nv">None</span><span class="s s-Atom">:</span> <span class="s s-Atom">raise</span> <span class="nv">Exception</span><span class="p">(</span><span class="s2">&quot;Table not found: %s&quot;</span> <span class="c1">% table_name)</span>

            <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">dbsession</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="nv">TableClass</span><span class="p">).</span><span class="nf">filter_by</span><span class="p">(</span><span class="s s-Atom">**data</span><span class="p">[</span><span class="s s-Atom">&#39;where&#39;</span><span class="p">])</span>
            <span class="s s-Atom">if</span> <span class="s s-Atom">&#39;orderby&#39;</span> <span class="s s-Atom">in</span> <span class="nn">data</span><span class="p">:</span>
                <span class="s s-Atom">for</span> <span class="s s-Atom">cname</span> <span class="s s-Atom">in</span> <span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;orderby&#39;</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s s-Atom">&#39;,&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
                    <span class="s s-Atom">reverse</span> <span class="o">=</span> <span class="nv">False</span>
                    <span class="s s-Atom">if</span> <span class="s s-Atom">cname</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="s s-Atom">&#39; desc&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
                        <span class="s s-Atom">reverse</span> <span class="o">=</span> <span class="nv">True</span>
                        <span class="s s-Atom">cname</span> <span class="o">=</span> <span class="s s-Atom">cname</span><span class="p">[:-</span><span class="mi">5</span><span class="p">]</span>
                    <span class="s s-Atom">elif</span> <span class="s s-Atom">cname</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="s s-Atom">&#39; asc&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
                        <span class="s s-Atom">cname</span> <span class="o">=</span> <span class="s s-Atom">cname</span><span class="p">[:-</span><span class="mi">4</span><span class="p">]</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;cname: &quot;</span><span class="p">,</span> <span class="s s-Atom">cname</span><span class="p">)</span>
                    <span class="s s-Atom">column</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="nv">TableClass</span><span class="p">,</span> <span class="s s-Atom">cname</span><span class="p">)</span>
                    <span class="s s-Atom">if</span> <span class="nn">reverse</span><span class="p">:</span> <span class="s s-Atom">column</span> <span class="o">=</span> <span class="nf">desc</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">)</span>
                    <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">order_by</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">)</span>
            <span class="s s-Atom">if</span> <span class="s s-Atom">&#39;limit&#39;</span> <span class="s s-Atom">in</span> <span class="nn">data</span><span class="p">:</span>
                <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;limit&#39;</span><span class="p">])</span>
                <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">offset</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;offset&#39;</span><span class="p">])</span>
            <span class="s s-Atom">object</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">all</span><span class="p">()</span>
            <span class="s s-Atom">data</span> <span class="o">=</span> <span class="p">[</span><span class="nf">object_as_dict</span><span class="p">(</span><span class="s s-Atom">t</span><span class="p">)</span> <span class="s s-Atom">for</span> <span class="s s-Atom">t</span> <span class="s s-Atom">in</span> <span class="s s-Atom">object</span><span class="p">]</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span> 
                <span class="s2">&quot;data&quot;</span><span class="s s-Atom">:</span> <span class="s s-Atom">data</span>
                <span class="p">})</span>
        <span class="s s-Atom">except</span> <span class="nv">Exception</span> <span class="s s-Atom">as</span> <span class="nn">e</span><span class="p">:</span>
            <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="s s-Atom">:</span> <span class="nf">str</span><span class="p">(</span><span class="s s-Atom">e</span><span class="p">),</span>
                <span class="p">})</span>
    <span class="nn">else</span><span class="p">:</span>
        <span class="s s-Atom">return</span> <span class="nf">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="s s-Atom">:</span> <span class="s2">&quot;Unrecognized verb.&quot;</span><span class="p">,</span>
            <span class="p">})</span>
</pre></div>


<p>I’ve used a non-standard HTTP method, <code class="highlighter-rouge">FETCH</code> for the <code class="highlighter-rouge">SELECT</code> action. That’s because if you use the <code class="highlighter-rouge">GET</code> method, you aren’t allowed to actually post data (as in actual posting, don’t confuse with <code class="highlighter-rouge">POST</code> method) as per the HTTP specification. The other methods, viz <code class="highlighter-rouge">POST</code>, <code class="highlighter-rouge">PUT</code> and <code class="highlighter-rouge">DELETE</code> are self-apparent and they stand for <code class="highlighter-rouge">INSERT</code>, <code class="highlighter-rouge">UPDATE</code> and <code class="highlighter-rouge">DELETE</code> actions respectively.</p>
<p>As you can see, the app makes good use of the sql expression language of sqlalchemy to dynamically query any kind of data, not only using the usual <code class="highlighter-rouge">where</code> clause, but also using ordering and pagination (limit/offset) parameters:</p>
<div class="highlight"><pre><span></span><span class="s s-Atom">if</span> <span class="s s-Atom">&#39;orderby&#39;</span> <span class="s s-Atom">in</span> <span class="nn">data</span><span class="p">:</span>
    <span class="s s-Atom">for</span> <span class="s s-Atom">cname</span> <span class="s s-Atom">in</span> <span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;orderby&#39;</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s s-Atom">&#39;,&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">reverse</span> <span class="o">=</span> <span class="nv">False</span>
        <span class="s s-Atom">if</span> <span class="s s-Atom">cname</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="s s-Atom">&#39; desc&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
            <span class="s s-Atom">reverse</span> <span class="o">=</span> <span class="nv">True</span>
            <span class="s s-Atom">cname</span> <span class="o">=</span> <span class="s s-Atom">cname</span><span class="p">[:-</span><span class="mi">5</span><span class="p">]</span>
        <span class="s s-Atom">elif</span> <span class="s s-Atom">cname</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="s s-Atom">&#39; asc&#39;</span><span class="p">)</span><span class="s s-Atom">:</span>
            <span class="s s-Atom">cname</span> <span class="o">=</span> <span class="s s-Atom">cname</span><span class="p">[:-</span><span class="mi">4</span><span class="p">]</span>
        <span class="nf">print</span><span class="p">(</span><span class="s2">&quot;cname: &quot;</span><span class="p">,</span> <span class="s s-Atom">cname</span><span class="p">)</span>
        <span class="s s-Atom">column</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="nv">TableClass</span><span class="p">,</span> <span class="s s-Atom">cname</span><span class="p">)</span>
        <span class="s s-Atom">if</span> <span class="nn">reverse</span><span class="p">:</span> <span class="s s-Atom">column</span> <span class="o">=</span> <span class="nf">desc</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">)</span>
        <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">order_by</span><span class="p">(</span><span class="s s-Atom">column</span><span class="p">)</span>
<span class="s s-Atom">if</span> <span class="s s-Atom">&#39;limit&#39;</span> <span class="s s-Atom">in</span> <span class="nn">data</span><span class="p">:</span>
    <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;limit&#39;</span><span class="p">])</span>
    <span class="s s-Atom">query</span> <span class="o">=</span> <span class="s s-Atom">query</span><span class="p">.</span><span class="nf">offset</span><span class="p">(</span><span class="s s-Atom">data</span><span class="p">[</span><span class="s s-Atom">&#39;offset&#39;</span><span class="p">])</span>
</pre></div>


<p>The front-end sends whatever it needs to the back-end using JSON format and the result is also in JSON. For example, the following JSON when posted to <code class="highlighter-rouge">/user</code> endpoint using <code class="highlighter-rouge">FETCH</code> method, returns the record from user table where <code class="highlighter-rouge">name</code> field matches <code class="highlighter-rouge">admin</code> and orders the results by email in descending order.</p>
<div class="highlight"><pre><span></span>{&quot;where&quot;: {&quot;name&quot;:&quot;admin&quot;}, &quot;orderby&quot;: &quot;email desc&quot;}
</pre></div>


<p>Adding the <code class="highlighter-rouge">limit</code> and <code class="highlighter-rouge">offset</code> clauses to the same can help the front-end with pagination.</p>
<div class="highlight"><pre><span></span>{&quot;where&quot;: {&quot;name&quot;:&quot;admin&quot;}, &quot;orderby&quot;: &quot;email desc&quot;, &quot;limit&quot;:2, &quot;offset&quot;: 2}
</pre></div>


<p>Its also pretty trivial to implement user authentication with this design. I haven’t done it in this example for simplicity, but you can find it in the <a href="https://github.com/prahladyeri/tiddly">github code</a>.</p>
<p>All code in this tutorial and on github is <code class="highlighter-rouge">MIT</code> licensed and free to use. So, enjoy coding, build your own RESTful CRUD app, and let me know how it goes via comments below!</p><p>There are <a href="https://prahladyeri.com/blog/2017/06/flask-recipe-restful-crud-using-sqlalchemy.html#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://prahladyeri.com/blog/2016/12/how-to-create-google-drive-app-python-flask.html" rel="bookmark"
                           title="Permalink to How to create a Google Drive App in Flask">How to create a Google Drive App in Flask</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-12-29T04:21:00+05:30">
                Published: Thu 29 December 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://prahladyeri.com/author/prahlad-yeri.html">Prahlad Yeri</a>
        </address>
<p>In <a href="https://prahladyeri.com/category/python.html">Python</a>.</p>
<p>tags: <a href="https://prahladyeri.com/tag/flask.html">Flask</a> <a href="https://prahladyeri.com/tag/google-drive.html">Google Drive</a> <a href="https://prahladyeri.com/tag/python.html">Python</a> </p>
</footer><!-- /.post-info -->                <p>This is the first in a series of articles for web programmers that explain in detail about using the Google Drive API in your web applications to access files/folders on behalf of the users of your application. In my last project, I had to develop a python flask app …</p>
                <a class="readmore" href="https://prahladyeri.com/blog/2016/12/how-to-create-google-drive-app-python-flask.html">read more</a>
<p>There are <a href="https://prahladyeri.com/blog/2016/12/how-to-create-google-drive-app-python-flask.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://prahladyeri.com/blog/2015/07/sqlalchemy-hack-convert-dict.html" rel="bookmark"
                           title="Permalink to Sqlalchemy Hack - How to convert a table to dict on the fly">Sqlalchemy Hack - How to convert a table to dict on the fly</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-07-04T18:36:00+05:30">
                Published: Sat 04 July 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://prahladyeri.com/author/prahlad-yeri.html">Prahlad Yeri</a>
        </address>
<p>In <a href="https://prahladyeri.com/category/python.html">Python</a>.</p>
<p>tags: <a href="https://prahladyeri.com/tag/sqlalchemy.html">SQLAlchemy</a> <a href="https://prahladyeri.com/tag/python.html">Python</a> </p>
</footer><!-- /.post-info -->                <p>In on of my recent projects, I came across the need to develop a JSON based REST API to fetch data from the <code>sqlalchemy</code> objects. Now, the <code>Query</code> object is a great way to access data using the powerful <code>sqlalchemy orm</code>, but it doesn’t give any built-in way to …</p>
                <a class="readmore" href="https://prahladyeri.com/blog/2015/07/sqlalchemy-hack-convert-dict.html">read more</a>
<p>There are <a href="https://prahladyeri.com/blog/2015/07/sqlalchemy-hack-convert-dict.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://prahladyeri.com/blog/2015/02/how-to-host-flask-app-openshift.html" rel="bookmark"
                           title="Permalink to How to host a Flask app on Openshift">How to host a Flask app on Openshift</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-02-06T18:30:00+05:30">
                Published: Fri 06 February 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://prahladyeri.com/author/prahlad-yeri.html">Prahlad Yeri</a>
        </address>
<p>In <a href="https://prahladyeri.com/category/python.html">Python</a>.</p>
<p>tags: <a href="https://prahladyeri.com/tag/python.html">Python</a> <a href="https://prahladyeri.com/tag/flask.html">Flask</a> <a href="https://prahladyeri.com/tag/openshift.html">Openshift</a> </p>
</footer><!-- /.post-info -->                <p><em>Note: This article may no longer be relevant as Red Hat has recently changed the openshift stack with docker and kubernetes.</em></p>
<p><a href="https://www.openshift.com/">Openshift free tier</a> is an excellent way to host your python web app for staging or testing, and you can even host a low to medium traffic production site …</p>
                <a class="readmore" href="https://prahladyeri.com/blog/2015/02/how-to-host-flask-app-openshift.html">read more</a>
<p>There are <a href="https://prahladyeri.com/blog/2015/02/how-to-host-flask-app-openshift.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://prahladyeri.com/blog/2013/12/how-to-host-your-own-mail-server-using-google-appengine.html" rel="bookmark"
                           title="Permalink to How to host your own mail server using Google appengine">How to host your own mail server using Google appengine</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-12-30T21:23:00+05:30">
                Published: Mon 30 December 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://prahladyeri.com/author/prahlad-yeri.html">Prahlad Yeri</a>
        </address>
<p>In <a href="https://prahladyeri.com/category/python.html">Python</a>.</p>
<p>tags: <a href="https://prahladyeri.com/tag/python.html">Python</a> <a href="https://prahladyeri.com/tag/google-app-engine.html">Google App Engine</a> </p>
</footer><!-- /.post-info -->                <p>Google has an outstanding habit of bringing the power of elites to the masses. Firstly, they took over the world of smartphones with android, and now the buzzword everywhere is Google Appengine.<!--more--></p>
<p>Once you get the basics of GAE and start looking beyond your first <a href="/blog/2013/12/how-to-create-a-pythonic-app-in-google-app-engine/" title="How to create a Python app in Google App Engine">HelloWorld</a> application, you will start …</p>
                <a class="readmore" href="https://prahladyeri.com/blog/2013/12/how-to-host-your-own-mail-server-using-google-appengine.html">read more</a>
<p>There are <a href="https://prahladyeri.com/blog/2013/12/how-to-host-your-own-mail-server-using-google-appengine.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://prahladyeri.com/blog/2013/12/how-to-create-a-python-app-in-google-app-engine.html" rel="bookmark"
                           title="Permalink to How to create a Python app in Google App Engine">How to create a Python app in Google App Engine</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-12-06T18:35:00+05:30">
                Published: Fri 06 December 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://prahladyeri.com/author/prahlad-yeri.html">Prahlad Yeri</a>
        </address>
<p>In <a href="https://prahladyeri.com/category/python.html">Python</a>.</p>
<p>tags: <a href="https://prahladyeri.com/tag/google-app-engine.html">Google App Engine</a> </p>
</footer><!-- /.post-info -->                <p>Whilst the <a href="https://developers.google.com/appengine/docs/python">official pythonic reference</a> for Google app engine is the way I learnt how to build my first GAE app, I found it a bit frustrating to go through <a href="https://developers.google.com/appengine/docs/python/#Python_Selecting_the_Python_runtime">each</a> and <a href="https://developers.google.com/appengine/docs/python/#Python_The_environment">every</a> link and understand large topics like caching and data stores in detail just to build a small …</p>
                <a class="readmore" href="https://prahladyeri.com/blog/2013/12/how-to-create-a-python-app-in-google-app-engine.html">read more</a>
<p>There are <a href="https://prahladyeri.com/blog/2013/12/how-to-create-a-python-app-in-google-app-engine.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://prahladyeri.com/blog/2013/11/how-to-generate-pdf-in-python-for-google-app-engine.html" rel="bookmark"
                           title="Permalink to How to Generate PDFs in Python for Google App Engine">How to Generate PDFs in Python for Google App Engine</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2013-11-26T19:07:00+05:30">
                Published: Tue 26 November 2013
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://prahladyeri.com/author/prahlad-yeri.html">Prahlad Yeri</a>
        </address>
<p>In <a href="https://prahladyeri.com/category/python.html">Python</a>.</p>
<p>tags: <a href="https://prahladyeri.com/tag/google-app-engine.html">Google App Engine</a> <a href="https://prahladyeri.com/tag/python.html">Python</a> </p>
</footer><!-- /.post-info -->                <p>One of my last projects based on google app engine and python involved storing form data in GAE datastore and generating PDF documents that the user can download. Whilst data storing was the easier part as google's big data API it is pretty <a href="https://developers.google.com/appengine/docs/python/datastore/">well documented</a>, the trickier aspect was to …</p>
                <a class="readmore" href="https://prahladyeri.com/blog/2013/11/how-to-generate-pdf-in-python-for-google-app-engine.html">read more</a>
<p>There are <a href="https://prahladyeri.com/blog/2013/11/how-to-generate-pdf-in-python-for-google-app-engine.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="mailto:prahladyeri@yahoo.com">Email</a></li>
                            <li><a href="https://github.com/prahladyeri/">Github</a></li>
                            <li><a href="https://stackoverflow.com/users/849365/prahlad-yeri/">StackOverflow</a></li>
                            <li><a href="https://www.quora.com/profile/Prahlad-Yeri">Quora</a></li>
                            <li><a href="https://mastodon.social/@prahladyeri">Mastodon.Social</a></li>
                            <li><a href="https://www.blogger.com/profile/12769325975373447545">Blogger</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://prahladyeri.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://www.linkedin.com/in/prahlad-yeri-243a5316">Linkedin</a></li>
                            <li><a href="https://www.facebook.com/prahladyeri14">Facebook</a></li>
                            <li><a href="https://twitter.com/prahladyeri">Twitter</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Copyright (c) 2013-2019 <a href="/">Prahlad Yeri</a>.
				<br>
				This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-6808883-5', 'auto');
    ga('send', 'pageview');
    </script>
<script type="text/javascript">
    var disqus_shortname = 'prahladyeri-blog';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>