<!DOCTYPE html>
<html lang="english">
<head>
        <meta charset="utf-8" />
        <title>Prahlad Yeri - Freelance Programmer - Backup</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Prahlad Yeri - Freelance Programmer Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Prahlad Yeri - Freelance Programmer </a></h1>
                <nav><ul>
				<li><a href="/">Home</a></li> <!--hard coded-->
                    <li><a href="/about/">About</a></li>
                    <li><a href="/projects/">Projects</a></li>
                    <li><a href="/hire-me/">Hire Me</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/blog/2018/03/how-to-use-bashrsync-to-automate-your-periodical-backups-on-linux.html">How to use Bash+rsync to automate your periodical backups on Linux</a></h1>
<footer class="post-info">
        <abbr class="published" title="2018-03-04T13:05:00+05:30">
                Published: Sun 04 March 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/prahlad-yeri.html">Prahlad Yeri</a>
        </address>
<p>In <a href="/category/linux.html">Linux</a>.</p>
<p>tags: <a href="/tag/backup.html">Backup</a> <a href="/tag/linux.html">Linux</a> <a href="/tag/ubuntu.html">Ubuntu</a> </p>
</footer><!-- /.post-info --><p><strong>Linux</strong> is all about simplicity. Simple and time-tested tools like <code>iptables</code>, <code>netstat</code> and <code>rsync</code> can be called for help for basic tasks instead of untrusted third-party tools as happens in case of Windows. If you are a desktop user, then taking frequent backups of your data to a pen-drive or external disk is a typical problem to solve.<!--more--></p>
<p>In this article, I'll show how I solved this problem using a combination of <strong>bash scripting</strong> and <strong>rsync</strong>, the basic tooling available on any linux distro these days, be it Ubuntu, Debian or Fedora.</p>
<p>One of the things you may want to do is determine what folder(s) you want to backup to which device. You may want to copy the source code folder only to your pen drive and your images and documents to only external drive, for instance. Here is where identifying the disk label through bash comes in handy in the backup script:</p>
<p>``` {.brush: .bash}
if [ -d "/media/prahlad/DATA128" ]; then
    device_name="DATA128"
    folder_name="/media/prahlad/DATA128"
elif [ -d "/media/prahlad/extHD" ]; then
    device_name="extHD"
    folder_name="/media/prahlad/extHD"
else
    echo "No Drive Found"
    exit
fi</p>
<div class="highlight"><pre><span></span>In the above example, **DATA128** is a pen-drive and **extHD** is an external hard-drive and the above script determines which disk is inserted in the USB drive. You can then use the **\$folder\_name** bash variable to dynamically copy to that device instead of hard-coding that path unnecessarily. You can also use **\$device\_name** bash variable to include or skip specific folders when running the rsync command:

``` {.brush: .bash}
rsync -va /home/prahlad/source &quot;$folder_name/source&quot;

if [ &quot;$device_name&quot; = &quot;extHD&quot; ]; then
 rsync -va /home/prahlad/Pictures &quot;$folder_name/home/Pictures&quot;
 rsync -va /home/prahlad/Documents &quot;$folder_name/home/Documents&quot;
fi
</pre></div>


<p>The <strong>rsync</strong> command itself is also versatile enough to do a lot of things which are not possible using a simple copy-paste-replace using a file manager. For instance, the "a" or "--archive" option intelligently archives (copies) files while skipping identical ones based on checksum or modification date automatically. Further, the "--delete" option deletes files which are present on the destination backup device, but not on the source device which is typically the case when you want to backup your data. Run "man rsync" to see the full range of options exposed by this wonderful command.</p>
<p>Finally, another advantage of using a script for backup automation is that you can implement custom actions through the script. For example, compressing the mozilla firefox user folder before taking its backup:</p>
<p>``` {.brush: .bash}
echo "backing up firefox..."
tar czf ~/firefox-backup.tar.gz ~/.mozilla/firefox/
rsync -va ~/firefox-backup.tar.gz "$folder_name/home/firefox-backup.tar.gz"</p>
<div class="highlight"><pre><span></span>Below is a typical example of how you might implement a script to automate backup of your home folder and set this as a cron job to run say weekly or fortnightly:

``` {.brush: .bash}
#!/bin/sh

if [ -d &quot;/media/prahlad/DATA128&quot; ]; then
 device_name=&quot;DATA128&quot;
 folder_name=&quot;/media/prahlad/DATA128&quot;
elif [ -d &quot;/media/prahlad/extHD&quot; ]; then
 device_name=&quot;extHD&quot;
 folder_name=&quot;/media/prahlad/extHD&quot;
else
 echo &quot;No Drive Found&quot;
 exit
fi

echo &quot;Device: $device_name&quot;
echo &quot;Folder: $folder_name&quot;

#start copying 

#home
rsync -va ~/.bashrc &quot;$folder_name/home/&quot; --delete
rsync -va ~/.profile &quot;$folder_name/home/&quot; --delete
rsync -va ~/Downloads/ &quot;$folder_name/home/Downloads/&quot; --delete
rsync -va ~/Documents/ &quot;$folder_name/home/Documents/&quot; --delete
rsync -va ~/Pictures/ &quot;$folder_name/home/Pictures/&quot; --delete
rsync -va ~/.ssh/ &quot;$folder_name/home/.ssh/&quot; --delete
rsync -va ~/.gnupg/ &quot;$folder_name/home/.gnupg/&quot; --delete
rsync -va ~/.thunderbird/ &quot;$folder_name/home/.thunderbird/&quot; --delete
rsync -va ~/.mozilla/ &quot;$folder_name/home/.mozilla/&quot; --delete

echo &quot;Done&quot;
</pre></div>


<p>You can customize the above script by adding custom actions or if conditions to skip or include specific folders based on the device label. If you know of any other techniques for backup automation on linux, then please let us know through comments.</p><p>There are <a href="/blog/2018/03/how-to-use-bashrsync-to-automate-your-periodical-backups-on-linux.html#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="mailto:prahladyeri@yahoo.com">Email</a></li>
                            <li><a href="https://github.com/prahladyeri/">Github</a></li>
                            <li><a href="https://stackoverflow.com/users/849365/prahlad-yeri/">StackOverflow</a></li>
                            <li><a href="https://www.quora.com/profile/Prahlad-Yeri-%E0%A4%AA%E0%A5%8D%E0%A4%B0%E0%A4%B9%E0%A5%8D%E0%A4%B2%E0%A4%BE%E0%A4%A6-%E0%A4%AF%E0%A5%87%E0%A4%B0%E0%A5%80">Quora</a></li>
                            <li><a href="https://mastodon.social/@prahladyeri">Mastodon.Social</a></li>
                            <li><a href="https://www.blogger.com/profile/12769325975373447545">Blogger</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://www.linkedin.com/in/prahlad-yeri-243a5316">Linkedin</a></li>
                            <li><a href="https://www.facebook.com/prahladyeri14">Facebook</a></li>
                            <li><a href="https://twitter.com/prahladyeri">Twitter</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Copyright (c) 2013-2019 <a href="/">Prahlad Yeri</a>.
				<br>
				This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'https://prahladyeri-blog.disqus.com';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>